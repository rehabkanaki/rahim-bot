import os
from telegram import Update
from telegram.ext import ApplicationBuilder, CommandHandler, MessageHandler, ContextTypes, filters

# Ø¬Ù„Ø¨ Ø§Ù„ØªÙˆÙƒÙ† ÙˆØ§Ù„Ø±Ø§Ø¨Ø· Ù…Ù† Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¨ÙŠØ¦Ø©
BOT_TOKEN = os.getenv("BOT_TOKEN")
APP_URL = os.getenv("APP_URL")  # Ù…Ø«Ø§Ù„: https://rahim-bot.onrender.com

# Ø¯Ø§Ù„Ø© start
async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    await update.message.reply_text("Ù…Ø±Ø­Ø¨Ù‹Ø§! Ø¨ÙˆØª Ø±Ø­ÙŠÙ… Ø´ØºØ§Ù„ âœ…")

# Ø¯Ø§Ù„Ø© echo
async def echo(update: Update, context: ContextTypes.DEFAULT_TYPE):
    print("ğŸ“¨ Ø±Ø³Ø§Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© ÙˆØµÙ„Øª:", update.message.text)
    await update.message.reply_text(f"Ø¥Ù†Øª ÙƒØªØ¨Øª: {update.message.text}")

# Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙˆØ¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø§Øª
def get_application():
    app = ApplicationBuilder().token(BOT_TOKEN).build()
    app.add_handler(CommandHandler("start", start))
    app.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, echo))
    return app

# ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¨ÙˆØª Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Webhook
if __name__ == "__main__":
    app = get_application()

    # ØªØ´ØºÙŠÙ„ Ø§Ù„Ø³ÙŠØ±ÙØ± Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… webhook
    app.run_webhook(
        listen="0.0.0.0",
        port=int(os.environ.get("PORT", 8443)),
        webhook_url=f"{APP_URL}/webhook"
    )
